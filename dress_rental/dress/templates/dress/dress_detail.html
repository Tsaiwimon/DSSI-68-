{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>{{ dress.name }}</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
</head>
<body class="bg-gray-50">

<!-- Header (‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Home) -->
<header class="bg-gradient-to-r from-pink-200 via-yellow-100 to-blue-200 shadow w-full">
  <div class="w-full px-10 py-9 flex items-center justify-between">
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <img src="/media/img_home_logos/Screenshot 2025-09-14 022514.png" alt="Logo" class="w-10 h-10 rounded-full">
      <span class="font-bold text-xl text-gray-700">Glam & Borrow</span>
    </div>

    <!-- Search -->
    <form method="get" action="{% url 'dress:home' %}" class="flex w-1/2 max-w-2xl">
      <input type="text" name="q" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£"
             value="{{ request.GET.q|default_if_none:'' }}"
             class="flex-grow px-3 py-2 border rounded-l-lg focus:outline-none">
      <button type="submit" class="px-4 py-2 bg-white border border-l-0 rounded-r-lg hover:bg-gray-100">
        üîç
      </button>
    </form>

    <!-- Menu -->
    <div class="flex items-center space-x-8">
      <nav class="flex space-x-6 font-medium">
        <a href="{% url 'dress:home' %}" class="hover:underline">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <a href="{% url 'dress:how_to_rent' %}" class="hover:underline">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡πà‡∏≤</a>
      </nav>

      {% if request.user.is_authenticated %}
        <a href="{% url 'dress:member_home' %}" class="font-medium hover:underline">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
        <a href="{% url 'dress:logout' %}" class="font-medium hover:underline">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
      {% else %}
        <a href="{% url 'dress:login' %}" class="font-medium hover:underline">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      {% endif %}
    </div>
  </div>
</header>

<!-- Content -->
<div class="max-w-7xl mx-auto px-10 py-10 relative">

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
  <button onclick="history.back()"
          class="absolute -left-6 top-6 md:-left-12 bg-white border rounded-full shadow-md w-10 h-10 
                 flex items-center justify-center hover:bg-gray-100 transition">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
         stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-700">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
    </svg>
  </button>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô + ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á -->
    <div>
      <img src="{{ dress.image.url }}" alt="{{ dress.name }}"
           class="rounded-lg shadow-lg w-full max-h-[480px] object-cover">
      <!-- ‡πÉ‡∏ä‡πâ total_rented -->
      <p class="mt-2 text-gray-500 text-sm">
        ‡πÄ‡∏ä‡πà‡∏≤‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß {{ total_rented }} ‡∏ä‡∏∏‡∏î
      </p>

      <a href="#"
         class="mt-4 bg-yellow-400 text-gray-900 px-4 py-2 rounded shadow hover:bg-yellow-500 font-medium flex items-center space-x-2 w-fit">
        <i class="fa-solid fa-camera"></i><span>‡∏•‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢ AI</span>
      </a>

      <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô -->
      <div class="mt-6 bg-white border rounded-xl shadow p-4 flex flex-col sm:flex-row sm:items-center gap-4">
        <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡πâ‡∏≤‡∏ô -->
        <div class="flex items-center justify-center">
          {% if dress.shop.shop_logo %}
            <img src="{{ dress.shop.shop_logo.url }}"
                 class="w-12 h-12 rounded-full object-cover"
                 alt="{{ dress.shop.name }}">
          {% else %}
            <div class="w-12 h-12 rounded-full bg-gray-100 border border-gray-200
                        flex items-center justify-center text-xs text-gray-500">
              ‡∏£‡πâ‡∏≤‡∏ô
            </div>
          {% endif %}
        </div>

        <!-- ‡∏Å‡∏•‡∏≤‡∏á: ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô + ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ -->
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2">
            <span class="text-xs text-gray-500">‡∏£‡πâ‡∏≤‡∏ô</span>
            <p class="font-semibold text-gray-900 truncate">
              {{ dress.shop.name }}
            </p>

            {% if dress.shop.is_open %}
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px]
                           bg-emerald-50 text-emerald-700 border border-emerald-100">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
              </span>
            {% else %}
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px]
                           bg-yellow-50 text-yellow-800 border border-yellow-200">
                ‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
              </span>
            {% endif %}
          </div>

          <div class="mt-1 flex flex-wrap items-center gap-3 text-xs text-gray-500">
            <div class="flex items-center gap-1">
              <span class="text-yellow-400 text-sm">‚òÖ</span>
              <span class="font-semibold text-gray-800">4.8</span>
              <span class="text-[11px] text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°</span>
            </div>

            <span class="hidden sm:inline-block w-px h-4 bg-gray-200"></span>

            <span class="text-[11px] text-gray-500">
              ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡πà‡∏≠‡∏¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£
            </span>
          </div>
        </div>

        <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô -->
        <div class="flex flex-col gap-2 w-full sm:w-40">
          <a href="{% url 'dress:public_store' dress.shop.id %}"
             class="text-center text-sm font-medium bg-blue-600 text-white px-3 py-2
                    rounded-lg shadow hover:bg-blue-700 transition">
            ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
          </a>
          <a href="{% url 'dress:shop_chat' dress.shop.id %}"
             class="text-center text-xs text-blue-700 bg-blue-50 px-3 py-1.5 rounded-lg
                    hover:bg-blue-100 border border-blue-100 transition">
            ‡πÄ‡πÄ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô
          </a>
        </div>
      </div>

      <!-- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á -->
      <div class="mt-4 bg-white border rounded-xl shadow p-4 overflow-y-auto h-60">
        <h3 class="text-sm font-semibold text-gray-900 mb-2">
          ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Glam & Borrow (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á)
        </h3>

        <h4 class="text-xs font-semibold text-gray-800">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h4>
        <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4 mb-2">
          <li>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</li>
          <li>‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏∞‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</li>
        </ul>

        <h4 class="text-xs font-semibold text-gray-800">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤</h4>
        <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4 mb-2">
          <li>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ß‡∏±‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‚Äù ‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>
          <li>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î</li>
        </ul>

        <h4 class="text-xs font-semibold text-gray-800">‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</h4>
        <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4 mb-2">
          <li>‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</li>
        </ul>

        <h4 class="text-xs font-semibold text-gray-800">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î</h4>
        <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4 mb-2">
          <li>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</li>
          <li>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</li>
        </ul>

        <h4 class="text-xs font-semibold text-gray-800">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h4>
        <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4 mb-2">
          <li>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏ä‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ‡∏â‡∏µ‡∏Å‡∏Ç‡∏≤‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á</li>
          <li>‡∏´‡∏≤‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</li>
        </ul>

        <p class="mt-1 text-[11px] text-gray-500 border-t pt-2">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î ‚Äú‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö 
          ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)
        </p>
      </div>
    </div>

    <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ä‡∏∏‡∏î -->
    <div class="relative">
      <div class="bg-white rounded-lg border shadow p-6 relative">

        <!-- ‡∏õ‡∏∏‡πà‡∏° Favorite -->
        <form method="POST" action="{% url 'dress:toggle_favorite' dress.id %}" class="absolute top-4 right-4">
          {% csrf_token %}
          <button type="submit"
                  class="w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-pink-100 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="{% if is_favorite %}red{% else %}none{% endif %}"
                 stroke="currentColor" stroke-width="2" class="w-5 h-5 text-gray-700">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5A4.69 4.69 0 0012 6.375
                       4.69 4.69 0 007.688 3.75C5.099 3.75 3 5.765 3 8.25
                       c0 7.688 9 12 9 12s9-4.312 9-12z" />
            </svg>
          </button>
        </form>

        <p class="text-red-600 text-2xl font-bold">‡∏ø {{ dress.daily_price }}/‡∏ß‡∏±‡∏ô</p>
        <h1 class="text-lg font-semibold mt-1">{{ dress.name }}</h1>

        <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î -->
        {% if not dress.shop.is_open %}
          <div class="mt-4 bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg p-4 text-sm">
            ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‚Äî ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
          </div>
        {% endif %}

        <!-- ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏ä‡πà‡∏≤ -->
        <div class="mt-4">
          <label for="rental_range" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πà‡∏≤</label>
          <input type="text" id="rental_range" name="rental_range"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                 placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"
                 {% if not dress.shop.is_open %}disabled{% endif %}>
          <div id="rentSummary" class="text-sm text-gray-700 mt-2 hidden">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <span id="selDays" class="font-semibold">‚Äì</span> ‡∏ß‡∏±‡∏ô ‚Äî 
            ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ß‡∏° <span id="selPrice" class="font-semibold">‚Äì</span> ‡∏ö‡∏≤‡∏ó
          </div>
          {% if not dress.shop.is_open %}
            <p class="text-xs text-gray-500 mt-1">* ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏à‡∏∂‡∏á‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πà‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>
          {% endif %}
        </div>

        <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ä‡∏∏‡∏î -->
        <div class="mt-4 text-sm text-gray-700 space-y-2">
          <p><span class="font-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</span> {{ dress.description|default:"-" }}</p>
          <p><span class="font-semibold">‡∏Ç‡∏ô‡∏≤‡∏î:</span> {{ dress.size|default:"-" }}</p>
          <p><span class="font-semibold">‡∏°‡∏±‡∏î‡∏à‡∏≥:</span> ‡∏ø {{ dress.deposit|default:"0" }}</p>
          <p><span class="font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span> {{ remaining_stock }} ‡∏ä‡∏∏‡∏î</p>
          <p class="text-xs text-gray-500">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
        </div>

        <!-- ‡πÅ‡∏û‡πá‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ -->
        {% if pack_prices %}
          <div class="mt-5 bg-blue-50/60 border border-blue-200 rounded-lg p-4">
            <h3 class="font-semibold text-blue-900">‡πÅ‡∏û‡πá‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</h3>
            <div class="mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2">
              {% for p in pack_prices %}
                <div class="flex items-center justify-between bg-white rounded-md border px-3 py-2"
                     data-pack-day="{{ p.days }}">
                  <span class="text-gray-600">{{ p.days }} ‡∏ß‡∏±‡∏ô</span>
                  <span class="font-semibold text-gray-900">‡∏ø{{ p.price|floatformat:2 }}</span>
                </div>
              {% endfor %}
            </div>
            <p class="text-xs text-gray-500 mt-2">* ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠ 1 ‡∏ä‡∏∏‡∏î (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á)</p>
          </div>
        {% endif %}

        <!-- ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á -->
        {% if shipping_tiers %}
          <div class="mt-4 bg-green-50/60 border border-green-200 rounded-lg p-4">
            <h3 class="font-semibold text-green-900">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏Ç‡∏≤‡πÑ‡∏õ (‡∏Ñ‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå/‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</h3>

            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2">
              {% for s in shipping_tiers %}
                <div class="flex items-center justify-between bg-white rounded-md border px-3 py-2">
                  <span class="text-gray-600">
                    {% if s.min_qty == s.max_qty %}
                      {{ s.min_qty }} ‡∏ä‡∏∏‡∏î
                    {% else %}
                      {{ s.min_qty }}‚Äì{{ s.max_qty }} ‡∏ä‡∏∏‡∏î
                    {% endif %}
                  </span>
                  <span class="font-semibold text-gray-900">‡∏ø{{ s.fee|floatformat:2 }}</span>
                </div>
              {% endfor %}
            </div>

            {% if shipping_clamp_note %}
              <p class="text-xs text-gray-500 mt-2">{{ shipping_clamp_note }}</p>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">* ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≤‡πÑ‡∏õ / ‡∏Ç‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏≠‡∏á</p>
          </div>
        {% endif %}

        <!-- ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß -->
        <div class="mt-6 border-t pt-4">
          <div class="flex items-center justify-between">
            <p class="text-sm text-gray-700">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ({{ review_count|default:0 }})</p>
            <div class="flex items-center text-yellow-500">
              {% for i in "12345" %}
                {% if forloop.counter <= avg_rating|default:0 %}
                  ‚òÖ
                {% else %}
                  ‚òÜ
                {% endif %}
              {% endfor %}
              <span class="ml-1 text-gray-700">{{ avg_rating|default:"0.0" }}/5</span>
            </div>
            <a href="{% url 'dress:review_list' dress.id %}"
               class="ml-2 bg-gray-100 px-3 py-1 rounded shadow hover:bg-gray-200 text-sm font-medium">
              ‡∏î‡∏π‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </a>
          </div>

          <div class="mt-3 space-y-2">
            {% for review in latest_reviews %}
              <div class="border rounded-lg bg-white shadow-sm p-3">
                <div class="flex items-center justify-between">
                  <p class="font-medium text-sm">{{ review.user.username|truncatechars:6 }}</p>
                  <div class="text-yellow-500 text-xs">
                    {% for i in "12345" %}
                      {% if forloop.counter <= review.rating %}
                        ‚òÖ
                      {% else %}
                        ‚òÜ
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
                <p class="text-sm text-gray-600 mt-1">{{ review.comment|truncatechars:60 }}</p>
              </div>
            {% empty %}
              <p class="text-gray-500 text-sm text-center mt-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</p>
            {% endfor %}
          </div>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πà‡∏≤ -->
        <div class="mt-6">
          {% if not dress.shop.is_open %}
            <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 text-center py-3 rounded font-semibold">
              ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‚Äî ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
            </div>

            <div class="mt-3 flex flex-wrap gap-3">
              <button disabled
                      class="flex-1 bg-gray-300 text-gray-700 py-2 rounded shadow cursor-not-allowed">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
              </button>

              <button disabled
                      class="flex-1 bg-gray-300 text-gray-700 py-2 rounded shadow cursor-not-allowed">
                ‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
              </button>
            </div>

          {% elif remaining_stock > 0 %}
            <div class="flex flex-wrap gap-3">
              <form id="add-to-cart-form" action="{% url 'dress:add_to_cart' dress.id %}" method="post" class="flex-1">
                {% csrf_token %}
                <button type="submit"
                        class="w-full bg-gray-800 text-white py-2 rounded shadow hover:bg-black text-center">
                  ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                </button>
              </form>

              <a href="{% url 'dress:rent_checkout' dress.id %}"
                 class="flex-1 bg-blue-600 text-white py-2 rounded shadow hover:bg-blue-700 text-center">
                ‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
              </a>
            </div>
          {% else %}
            <div class="bg-red-100 text-red-700 text-center py-3 rounded font-semibold">
              ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∏‡∏î‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πà‡∏≤
            </div>
          {% endif %}
        </div>

      </div>
    </div>

  </div>
</div>

<!-- ‡∏ä‡∏∏‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô -->
{% if related_dresses %}
  <div class="mt-16 mb-12 px-6 md:px-12">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏ä‡∏∏‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô {{ dress.shop.name }}</h2>

    <div class="bg-white rounded-xl shadow p-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8">
        {% for item in related_dresses %}
          <div class="bg-white shadow-sm rounded-lg overflow-hidden hover:shadow-lg transition-all duration-300">
            <a href="{% url 'dress:dress_detail' item.id %}">
              <img src="{{ item.image.url }}" alt="{{ item.name }}"
                   class="w-full h-64 object-cover hover:scale-105 transition-transform duration-300">
            </a>
            <div class="p-4">
              <p class="font-semibold text-gray-900 truncate mb-1">{{ item.name }}</p>
              <p class="text-pink-600 font-medium text-sm">‡∏ø{{ item.daily_price|floatformat:2 }}/‡∏ß‡∏±‡∏ô</p>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="flex justify-end mt-8">
        <a href="{% url 'dress:public_store' dress.shop.id %}"
           class="inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg
                  hover:bg-blue-700 hover:shadow-xl transition-all duration-200 font-semibold text-sm md:text-base">
          ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ä‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
               stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
    </div>
  </div>
{% endif %}

{{ pack_prices|json_script:"packPricesJSON" }}

<script>
  (function() {
    const fp = flatpickr("#rental_range", {
      mode: "range",
      locale: "th",
      dateFormat: "d/m/Y",
      minDate: "today"
    });
    window.__rentPicker = fp;
  })();
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("add-to-cart-form");
  if (!form) return;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    const response = await fetch(form.action, {
      method: "POST",
      headers: { "X-CSRFToken": csrfToken },
    });

    if (response.ok) {
      const popup = document.createElement("div");
      popup.className = `
        fixed top-5 right-5 bg-white text-black font-medium px-5 py-3 
        rounded-lg shadow-lg animate-fade-in z-50 border border-gray-300
      `;
      popup.innerHTML = `
        ‚úÖ <span class="ml-2">{{ dress.name }} ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!</span>
      `;
      document.body.appendChild(popup);
      setTimeout(() => {
        popup.classList.add("animate-fade-out");
        setTimeout(() => popup.remove(), 300);
      }, 2000);
    } else {
      const popup = document.createElement("div");
      popup.className = `
        fixed top-5 right-5 bg-red-500 text-white font-medium px-5 py-3 
        rounded-lg shadow-lg animate-fade-in z-50
      `;
      popup.innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏î‡πâ`;
      document.body.appendChild(popup);
      setTimeout(() => {
        popup.classList.add("animate-fade-out");
        setTimeout(() => popup.remove(), 300);
      }, 2000);
    }
  });
});

const style = document.createElement('style');
style.textContent = `
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOut {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-10px); }
}
.animate-fade-in { animation: fadeIn 0.25s ease-out; }
.animate-fade-out { animation: fadeOut 0.25s ease-in; }
`;
document.head.appendChild(style);

/* ‡∏ô‡∏±‡∏ö‡∏ß‡∏±‡∏ô + ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤ */
(function () {
  const packDataNode = document.getElementById("packPricesJSON");
  const packData = packDataNode ? JSON.parse(packDataNode.textContent || "[]") : [];
  const packMap = {};
  packData.forEach(p => {
    const d = Number(p.days);
    const price = Number(p.price);
    if (!isNaN(d) && !isNaN(price)) packMap[d] = price;
  });

  const DAILY = Number(("{{ dress.daily_price|default:'0' }}").toString().replace(/,/g, "")) || 0;

  const input = document.getElementById("rental_range");
  const fp = window.__rentPicker || (input ? input._flatpickr : null);

  const summary = document.getElementById("rentSummary");
  const selDays = document.getElementById("selDays");
  const selPrice = document.getElementById("selPrice");

  function thb(n) {
    return new Intl.NumberFormat("th-TH", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
  }

  function highlightPack(days) {
    document.querySelectorAll("[data-pack-day]").forEach(el => {
      el.classList.remove("ring-2","ring-blue-400","bg-blue-50");
    });
    const active = document.querySelector(`[data-pack-day="${days}"]`);
    if (active) active.classList.add("ring-2","ring-blue-400","bg-blue-50");
  }

  function updateSummary() {
    if (!fp) return;
    const dates = fp.selectedDates;
    if (!dates || dates.length < 2) {
      summary.classList.add("hidden");
      document.querySelectorAll("[data-pack-day]").forEach(el => {
        el.classList.remove("ring-2","ring-blue-400","bg-blue-50");
      });
      return;
    }
    const s = new Date(dates[0].getFullYear(), dates[0].getMonth(), dates[0].getDate());
    const e = new Date(dates[1].getFullYear(), dates[1].getMonth(), dates[1].getDate());
    const ONE = 24 * 60 * 60 * 1000;
    const days = Math.round((e - s) / ONE) + 1;
    if (days <= 0) {
      summary.classList.add("hidden");
      return;
    }

    selDays.textContent = days;

    let price = packMap[days];
    if (price == null && DAILY > 0) {
      price = DAILY * days;
    }

    if (price != null) {
      selPrice.textContent = thb(price);
      summary.classList.remove("hidden");
    } else {
      selPrice.textContent = "‚Äì";
      summary.classList.remove("hidden");
    }

    highlightPack(days);
  }

  if (fp) {
    fp.config.onChange.push(updateSummary);
    setTimeout(updateSummary, 0);
  }
})();
</script>

{% if messages %}
  <!-- Modal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤ -->
  <div id="rentClosedModal"
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
    <div class="bg-white rounded-2xl shadow-xl max-w-sm w-[90%]">
      <div class="px-5 py-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">
          ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
        </h3>
      </div>
      <div class="px-5 py-4">
        <p class="text-sm text-gray-700">
          {% for message in messages %}
            {{ message }}{% if not forloop.last %}<br>{% endif %}
          {% endfor %}
        </p>
      </div>
      <div class="px-5 py-3 border-t flex justify-end">
        <button id="rentClosedModalClose"
                class="inline-flex items-center rounded-lg px-4 py-2
                       bg-gray-800 text-white text-sm font-medium
                       hover:bg-black transition">
          ‡∏ï‡∏Å‡∏•‡∏á
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("rentClosedModal");
      const closeBtn = document.getElementById("rentClosedModalClose");

      if (!modal) return;

      function closeModal() {
        modal.classList.add("hidden");
      }

      closeBtn?.addEventListener("click", closeModal);

      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeModal();
        }
      });

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeModal();
        }
      });
    });
  </script>
{% endif %}

<!-- Modal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
<div id="dateAlert" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/40 backdrop-blur-[1px]" data-close="1"></div>
  <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-sm">
    <div class="bg-white rounded-2xl shadow-xl border">
      <div class="px-5 py-4">
        <h3 class="text-lg font-semibold text-gray-900">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
        <p class="mt-1 text-sm text-gray-600">
          ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î ‚Äú‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‚Äù
        </p>
      </div>
      <div class="border-t px-5 py-3 flex justify-end gap-2">
        <button id="dateAlertClose"
                class="inline-flex items-center rounded-lg px-4 py-2 bg-gray-800 text-white hover:bg-black">
          ‡∏ï‡∏Å‡∏•‡∏á
        </button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ‡∏ñ‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î listener ‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å render ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
  const checkoutURL = "{% url 'dress:rent_checkout' dress.id %}";
  const rentLink = document.querySelector('a[href="' + checkoutURL + '"]');
  if (!rentLink) return;

  const modal = document.getElementById('dateAlert');
  const closeBtn = document.getElementById('dateAlertClose');
  const openModal  = () => modal.classList.remove('hidden');
  const closeModal = () => modal.classList.add('hidden');

  modal?.addEventListener('click', (e) => { if (e.target.dataset.close) closeModal(); });
  closeBtn?.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

  function toISODate(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function daysInclusive(a, b){
    const A = new Date(a.getFullYear(), a.getMonth(), a.getDate());
    const B = new Date(b.getFullYear(), b.getMonth(), b.getDate());
    return Math.round((B - A) / (1000*60*60*24)) + 1;
  }

  rentLink.addEventListener('click', function(e){
    const fp = window.__rentPicker;
    if (!fp || !fp.selectedDates || fp.selectedDates.length < 2) {
      e.preventDefault();
      openModal();
      return;
    }
    const s = fp.selectedDates[0];
    const e2 = fp.selectedDates[1];
    const days = daysInclusive(s, e2);
    if (days <= 0) {
      e.preventDefault();
      openModal();
      return;
    }
    const params = new URLSearchParams({
      start_date: toISODate(s),
      end_date: toISODate(e2),
      days: String(days)
    });
    e.preventDefault();
    window.location.href = checkoutURL + "?" + params.toString();
  });
})();
</script>

</body>
</html>
