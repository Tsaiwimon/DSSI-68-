{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ยืนยันการชำระเงิน | Glam & Borrow</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">

<header class="bg-gradient-to-r from-pink-200 via-yellow-100 to-blue-200 shadow w-full">
  <div class="w-full px-8 py-9 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">ยืนยันการทำรายการ</h1>
      <p class="text-sm text-gray-600 mt-1">ตรวจสอบความถูกต้องก่อนชำระเงิน</p>
    </div>
    <a href="javascript:history.back()" class="text-gray-700 hover:text-pink-600 transition font-medium">
      ← กลับไปเลือกวันเช่า
    </a>
  </div>
</header>

<main class="max-w-4xl mx-auto py-8 px-6">
  <div class="bg-white rounded-2xl shadow-sm p-5 mb-8 border border-gray-100">
    <div class="flex items-center justify-between text-xs font-bold uppercase tracking-wider text-gray-400">
      <div>1) เลือกชุด</div>
      <div>2) เลือกวันเช่า</div>
      <div class="text-pink-600">3) ยืนยันรายการ</div>
    </div>
    <div class="mt-3 w-full bg-gray-100 rounded-full h-1.5">
      <div class="bg-pink-500 h-1.5 rounded-full" style="width: 100%;"></div>
    </div>
  </div>

  <div class="mb-6">
    <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
      <i class="fa-solid fa-calendar-days text-pink-500"></i> ระยะเวลาเช่า: {{ days }} วัน
    </h2>
    <p class="text-sm text-gray-500">{{ start_date|date:"d M Y" }} — {{ end_date|date:"d M Y" }}</p>
  </div>

  {% for shop_box in shops_list %}
  <div class="bg-white rounded-3xl shadow-sm border border-gray-100 mb-6 overflow-hidden">
    <div class="bg-gray-50/50 px-6 py-4 border-b border-gray-100 flex justify-between items-center">
        <span class="font-bold text-gray-800">
            <i class="fa-solid fa-store mr-2 text-pink-500"></i>{{ shop_box.store.name }}
        </span>
        <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">
            {{ shop_box.shop_qty }} รายการ
        </span>
    </div>
    
    <div class="divide-y divide-gray-50 px-6">
      {% for line in shop_box.lines %}
        <div class="py-5 flex items-center justify-between">
          <div class="flex items-center gap-5">
            <div class="w-16 h-20 rounded-xl overflow-hidden shadow-sm border border-gray-100">
              {% if line.item.dress.image %}
                <img src="{{ line.item.dress.image.url }}" class="w-full h-full object-cover">
              {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" class="w-full h-full object-cover">
              {% endif %}
            </div>
            <div>
              <p class="font-bold text-gray-800">{{ line.item.dress.name }}</p>
              <p class="text-xs text-gray-500 mt-1">จำนวน: x{{ line.qty }}</p>
              <p class="text-[11px] text-blue-600 font-bold mt-1">
                มัดจำสุทธิ: ฿{{ line.line_deposit|floatformat:2 }}
              </p>
            </div>
          </div>
          <div class="text-right">
            <p class="text-[10px] text-gray-400 uppercase font-bold">ค่าเช่า</p>
            <p class="font-bold text-gray-900">฿{{ line.line_rent|floatformat:2 }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <div class="bg-gray-50/30 px-6 py-4 text-right border-t border-gray-50">
        <p class="text-xs text-gray-500">ค่าจัดส่งร้านนี้: ฿{{ shop_box.shop_shipping|floatformat:2 }}</p>
        <p class="font-bold text-gray-800">รวมร้านนี้: <span class="text-pink-600">฿{{ shop_box.shop_total|floatformat:2 }}</span></p>
    </div>
  </div>
  {% empty %}
    <div class="py-20 text-center text-gray-400 bg-white rounded-3xl border-2 border-dashed border-gray-100">
        <i class="fa-solid fa-box-open text-4xl mb-3"></i>
        <p>ไม่พบรายการที่เลือก</p>
    </div>
  {% endfor %}

  <div class="bg-gray-900 rounded-[2.5rem] p-10 text-white mt-10 shadow-2xl relative overflow-hidden">
    <div class="absolute -top-10 -right-10 w-40 h-40 bg-pink-500/10 rounded-full blur-3xl"></div>

    <div class="space-y-4 relative z-10">
        <div class="flex justify-between text-gray-400 font-medium">
            <span>ค่าเช่ารวม ({{ days }} วัน)</span>
            <span class="text-white">฿{{ rental_total|floatformat:2 }}</span>
        </div>
        <div class="flex justify-between text-gray-400 font-medium">
            <span>มัดจำรวม (ได้รับคืนเมื่อคืนชุด)</span>
            <span class="text-white">฿{{ deposit_total|floatformat:2 }}</span>
        </div>
        <div class="flex justify-between text-gray-400 font-medium pb-4 border-b border-gray-800">
            <span>ค่าจัดส่งรวม</span>
            <span class="text-white">฿{{ shipping_total|floatformat:2 }}</span>
        </div>
        <div class="flex justify-between items-end pt-2">
            <div>
                <p class="text-xs text-pink-400 font-black uppercase tracking-[0.2em] mb-1">ยอดชำระสุทธิ</p>
                <p class="text-5xl font-black text-white tracking-tighter">฿{{ grand_total|floatformat:2 }}</p>
            </div>
            
            <form method="POST" action="{% url 'dress:cart_payment_start' %}" class="w-1/2">
                {% csrf_token %}
                {% for shop_box in shops_list %}
                    {% for line in shop_box.lines %}
                        <input type="hidden" name="ids" value="{{ line.item.id }}">
                    {% endfor %}
                {% endfor %}
                <input type="hidden" name="start_date" value="{{ start_date|date:'Y-m-d' }}">
                <input type="hidden" name="end_date" value="{{ end_date|date:'Y-m-d' }}">

                <button type="submit" class="w-full bg-pink-500 hover:bg-pink-600 text-white py-5 rounded-2xl text-xl font-black shadow-xl shadow-pink-500/20 transition-all transform hover:-translate-y-1 active:scale-95">
                    ชำระเงิน <i class="fa-solid fa-chevron-right ml-2 text-sm"></i>
                </button>
            </form>
        </div>
    </div>
  </div>

  <div class="mt-8 text-center">
    <a href="javascript:history.back()" class="text-sm text-gray-400 hover:text-gray-600 font-medium transition">
        <i class="fa-solid fa-arrow-left mr-1"></i> ย้อนกลับไปแก้ไขข้อมูล
    </a>
  </div>
</main>

</body>
</html>